function n(e){chrome.tabs.executeScript(e.id,{file:"js/2.min.js"},null)}var u,r,i,o,l,f,a="nfollowers.com",d="/instagram/3/dashboard.html",c=[],h=[],p=0,g=0,m=[],w=[],y=1050,T=95e3,v=3e3,_="https://www.instagram.com/";var x="37479f2b8209594dde7facb0d904896a",b="58712303d941c6855d4e888c5f0cd22f";function S(e,t,s,n,r){for(var a=0;a<m.length;a++)!function(t,e,s,n,r,a){chrome.tabs.sendMessage(t,{action:"scanStepFinished",type:e,viewer:s,followers:n,followings:r,followersCount:o,followsCount:l,reciprocal:a},function(e){chrome.runtime.lastError&&w.push(t)})}(m[a],e,t,s,n,r)}function q(e){for(var t=0;t<m.length;t++)chrome.tabs.sendMessage(m[t],{action:"error",type:e},function(e){chrome.runtime.lastError})}function O(e,t,s){var n=JSON.parse(e);r=n.csrf_token,i=n.viewer,u=n.viewer.id,function(i,o,u,e){try{var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==l.readyState&&200==this.status)try{var e=this.responseText.indexOf('"edge_followed_by"'),t=this.responseText.indexOf("}",e);t+=1;var s=this.responseText.substring(e,t),n=this.responseText.indexOf('"edge_follow"'),r=this.responseText.indexOf("}",n);r+=1;var a=this.responseText.substring(n,r);i("{"+s+"}","{"+a+"}",o,u)}catch(e){}else 403==this.status||429==this.status||l.readyState},l.open("GET",_+e+"/"),l.send()}catch(e){}}(M,t,s,i.username)}function M(e,t,s,n){var r=JSON.parse(e);o=r.edge_followed_by.count;var a=JSON.parse(t);l=a.edge_follow.count,S("main",i,null,null,null),function s(n,r,a){try{var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=(e.data.user.edge_followed_by.edges,e.data.user.edge_followed_by.page_info.end_cursor);if(A(a))return;E(),n(this.responseText,r,!(null!=t),!0,a),null!=t&&setTimeout(function(){z(n,t,r,a)},y)}else if(403==this.status)L(),H(),q("instagramNotAuthorized");else if(4==i.readyState&&429==this.status){if(A(a))return;E(),q("instagramApiTimeout"),setTimeout(function(){s(n,r,a)},T)}else if(4==i.readyState){if(A(a))return;E(),q("httpRequestError"),setTimeout(function(){s(n,r,a)},v)}},i.open("GET","https://www.instagram.com/graphql/query/?query_hash="+x+'&variables={"id":"'+u+'","first":24}'),i.send()}catch(e){}}(N,null,n)}function N(e,t,s,n,r){var a=JSON.parse(e);n&&(c=[]),c=c.concat(a.data.user.edge_followed_by.edges),S("followers",i,c,null,null),s&&function n(r,a,i){try{var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=e.data.user.edge_follow.edges,s=e.data.user.edge_follow.page_info.end_cursor;e.data.user.edge_follow.page_info.has_next_page;if(A(i))return;E(),r(this.responseText,a,!(0<t.length&&null!=s),!0,i),0<t.length&&null!=s&&setTimeout(function(){J(r,s,a,i)},y)}else if(403==this.status)L(),H(),q("instagramNotAuthorized");else if(4==o.readyState&&429==this.status){if(A(i))return;E(),q("instagramApiTimeout"),setTimeout(function(){n(r,a,i)},T)}else if(4==o.readyState){if(A(i))return;E(),q("httpRequestError"),setTimeout(function(){n(r,a,i)},v)}},o.open("GET","https://www.instagram.com/graphql/query/?query_hash="+b+'&variables={"id":"'+u+'","first":24}'),o.send()}catch(e){}}(R,null,r)}function R(e,t,s,n,r){var a=JSON.parse(e);n&&(h=[]),h=h.concat(a.data.user.edge_follow.edges),S("followings",i,c,h,null),s&&function(){for(var e=f=0;e<h.length;e++)!function(e){for(var t=0;t<c.length;t++){var s=c[t];if(s.node.id==e.node.id)return e.node.backfollow=!0,s.node.backfollow=!0,f++}e.node.backfollow=!1}(h[e]);g=p=0,S("count",i,c,h,f)}()}function A(e){return e!=p}function E(){g=(new Date).getTime()}function L(){g=p=0}function H(){c=[],h=[],f=0,u=i=null}function z(s,n,r,a){try{var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=(e.data.user.edge_followed_by.edges,e.data.user.edge_followed_by.page_info.end_cursor);if(A(a))return;E(),s(this.responseText,r,!(null!=t),!1,a),null!=t&&setTimeout(function(){z(s,t,r,a)},y)}else if(403==this.status)L(),H(),q("instagramNotAuthorized");else if(4==i.readyState&&429==this.status){if(A(a))return;E(),q("instagramApiTimeout"),setTimeout(function(){z(s,n,r,a)},T)}else if(4==i.readyState){if(A(a))return;E(),q("httpRequestError"),setTimeout(function(){z(s,n,r,a)},v)}};var e=(t=n,"https://www.instagram.com/graphql/query/?query_hash="+x+'&variables={"id":"'+u+'","first":'+(Math.floor(13*Math.random())+12)+',"after":"'+t+'"}');i.open("GET",e),i.send()}catch(e){}var t}function J(n,r,a,i){try{var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=e.data.user.edge_follow.edges,s=e.data.user.edge_follow.page_info.end_cursor;e.data.user.edge_follow.page_info.has_next_page;if(A(i))return;E(),n(this.responseText,a,!(0<t.length&&null!=s),!1,i),0<t.length&&null!=s&&setTimeout(function(){J(n,s,a,i)},y)}else if(403==this.status)L(),H(),q("instagramNotAuthorized");else if(4==o.readyState&&429==this.status){if(A(i))return;E(),q("instagramApiTimeout"),setTimeout(function(){J(n,r,a,i)},T)}else if(4==o.readyState){if(A(i))return;E(),q("httpRequestError"),setTimeout(function(){J(n,r,a,i)},v)}};var e=(t=r,"https://www.instagram.com/graphql/query/?query_hash="+b+'&variables={"id":"'+u+'","first":'+(Math.floor(13*Math.random())+12)+',"after":"'+t+'"}');o.open("GET",e),o.send()}catch(e){}var t}chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.create({url:"http://nfollowers.com/instagram/3/dashboard.html"},function(e){e.id,m.push(e.id)})}),chrome.tabs.onUpdated.addListener(function(e,t,s){"complete"===t.status&&null!=s.url&&s.url.includes(a)&&s.url.includes(d)&&(-1==m.indexOf(e)&&m.push(e),chrome.tabs.executeScript(s.id,{file:"lib/materialize/js/materialize.min.js"},null),n(s))}),chrome.runtime.onMessage.addListener(function(e,t,s){var n;return e&&"start-scan"==e.type&&(L(),H(),function a(i,o,u){try{var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==l.readyState&&200==this.status)try{var e=this.responseText.indexOf('"csrf_token":'),t=this.responseText.indexOf("}",e),s=this.responseText.indexOf('"}',e),n=t+1;null!=s&&t<s&&(n=s+2);var r=this.responseText.substring(e,n);if(null==r)return L(),void q("instagramNotAuthorized");if(A(u))return;E(),i("{"+r+"}",o,u)}catch(e){L(),q("instagramNotAuthorized")}else if(403==this.status)L(),H(),q("instagramNotAuthorized");else if(429==this.status){if(A(u))return;E(),q("instagramApiTimeout"),setTimeout(function(){a(i,o,u)},T)}else if(4==l.readyState){if(A(u))return;E(),q("httpRequestError"),setTimeout(function(){a(i,o,u)},v)}},l.open("GET",_),l.send()}catch(e){}}(O,s,p=(new Date).getTime())),e&&"get-scan-data"==e.type&&((n={}).viewer=i,n.followers=c,n.followings=h,n.reciprocal=f,n.scanId=p,n.lastScanActionTime=g,s(n)),!0}),chrome.runtime.onMessageExternal.addListener(function(e,t,s){var n;return e&&e.message&&("version"==e.message?(n="unknown",-1!=m.indexOf(t.tab.id)&&(n="connected"),-1!=w.indexOf(t.tab.id)&&(n="disconnected"),s({version:"1",tabStatus:n})):"unsubscribe"==e.message&&null!==e.accountId&&function(e,t){try{var s=new XMLHttpRequest;s.onreadystatechange=function(){(4==s.readyState&&200==this.status||4==s.readyState)&&t({status:this.status})},s.open("POST","https://www.instagram.com/web/friendships/"+e+"/unfollow/",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.setRequestHeader("x-csrftoken",r),s.setRequestHeader("x-requested-with","XMLHttpRequest"),s.send()}catch(e){}}(e.accountId,s)),!0});